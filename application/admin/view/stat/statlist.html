<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- jQuery 3 -->
<script src="__STATIC__/admin/adminlte/stat/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<!--<script src="__STATIC__/admin/adminlte/stat/bootstrap.min.js"></script>-->
<!-- Morris.js charts -->
<script src="__STATIC__/admin/adminlte/stat/raphael.min.js"></script>
<script src="__STATIC__/admin/adminlte/stat/morris.min.js"></script>
<!-- FastClick -->
<script src="__STATIC__/admin/adminlte/stat/fastclick.js"></script>
<!-- AdminLTE App -->
<style>
    #example1 tr:hover{
        background-color: #1EA2E3;color: white;
    }
    #example1 tr:hover input{
        background-color: white;color: #0f0f0f;
    }
    #example1 tr:hover td a,#example1 tr:hover td i{
        color:#fff;
    }
    #example1 thead tr:hover:first-child{background:none;color:#333}
</style>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/public/common.js"></script>
<script type="text/javascript" src="__STATIC__/public/jquery.pjax.min.js"></script>
<script type="text/javascript" src="__STATIC__/public/nprogress.js"></script>
<link rel="stylesheet" href="__STATIC__/public/nprogress.css">
<script src="__STATIC__/admin/adminlte/bower_components/select2/js/select2.min.js"></script>
<script src="__STATIC__/admin/adminlte/bower_components/select2/js/i18n/zh-CN.js"></script>
<link rel="stylesheet" href="__STATIC__/admin/adminlte/bower_components/select2/css/select2.min.css">

<script src="__STATIC__/admin/adminlte/bower_components/select2/js/i18n/zh-CN.js"></script>
<link rel="stylesheet" href="__STATIC__/admin/adminlte/bower_components/select2/css/select2.min.css">
<!-- date-range-picker -->
<script src="__STATIC__/admin/adminlte/bower_components/moment/min/moment.min.js"></script>
<script src="__STATIC__/admin/adminlte/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- bootstrap datepicker -->
<script src="__STATIC__/admin/adminlte/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<script src="__STATIC__/admin/adminlte/bower_components/moment/locale/zh-cn.js"></script>
<!-- daterange picker -->
<link rel="stylesheet" href="__STATIC__/admin/adminlte/bower_components/bootstrap-daterangepicker/daterangepicker.css">
<!-- bootstrap datepicker -->
<link rel="stylesheet" href="__STATIC__/admin/adminlte/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
<script>
    $(function () {
        "use strict";
        //BAR CHART
        var bar = new Morris.Bar({
            element: 'bar-chart',
            resize: true,
            data: [
                {y: '2006', a: 100, b: 90,c:70},
                {y: '2007', a: 75, b: 65,c:70},
                {y: '2008', a: 50, b: 40,c:70},
                {y: '2009', a: 75, b: 65,c:70},
                {y: '2010', a: 50, b: 40,c:70},
                {y: '2011', a: 75, b: 65,c:70},
                {y: '2012', a: 100, b: 90,c:70},
                {y: '2014', a: 75, b: 65,c:70},
                {y: '2015', a: 50, b: 40,c:70},
                {y: '2016', a: 75, b: 65,c:70},
                {y: '2017', a: 100, b: 90,c:70}
            ],
            barColors: ['#00a65a', '#f56954','red'],
            xkey: 'y',
            ykeys: ['a', 'b', 'c'],
            hideHover: 'auto'
        });
    });
</script>
<!-- Main content -->
<section class="content">
    <div class="callout callout-warning">
    <p style="font-size: 16px;font-weight:800">页面访问总次数： <b>{$list->total()}</b> 次</p>
    </div>
    <div class="row">
        <!-- /.col (LEFT) -->
        <div class="col-md-6" style="width: 100%;">
            <!-- BAR CHART -->
            <div class="box box-success">
                <div class="box-header with-border">
                </div>
                <div class="box-body chart-responsive">
                    <div class="col-sm-6" style="width: 100%">
                    <div class="col-md-3 col-sm-4" style="margin-bottom:20px;line-height: 40px;margin-top: 15px;">
                        <span style="width: 30%;display: block;float: left;">每页条数：</span><select datavalue="limit" class="form-control input-sm pjaxchangge" id="limitchangge" style="width: 50%;display: block;float: left;">
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    </div>
                    <div class="col-md-3 col-sm-4" style="width: 25%;line-height: 40px;margin-top: 15px;">
                        <div class="form-group" >
                            <div class="input-group">选择时间：
                                <button type="button" class="btn btn-default pull-right" id="daterange-btn">
                          <span>
                      <i class="fa fa-calendar"></i> 所有时间
                    </span>
                                    <i class="fa fa-caret-down"></i>
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="starttime"  value="all">
                        <input type="hidden" id="endtime"  value="all">
                    </div>
                </div>
                    <!--<div class="chart" id="bar-chart" style="height: 300px;width:70%; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><svg height="300" version="1.1" width="787" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></defs><text x="32.5" y="263" text-anchor="end" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: end; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">0</tspan></text><path fill="none" stroke="#aaaaaa" d="M45,263H761.5" stroke-width="0.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="32.5" y="203.5" text-anchor="end" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: end; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">25</tspan></text><path fill="none" stroke="#aaaaaa" d="M45,203.5H761.5" stroke-width="0.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="32.5" y="144" text-anchor="end" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: end; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">50</tspan></text><path fill="none" stroke="#aaaaaa" d="M45,144H761.5" stroke-width="0.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="32.5" y="84.5" text-anchor="end" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: end; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">75</tspan></text><path fill="none" stroke="#aaaaaa" d="M45,84.5H761.5" stroke-width="0.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="32.5" y="25" text-anchor="end" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: end; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">100</tspan></text><path fill="none" stroke="#aaaaaa" d="M45,25H761.5" stroke-width="0.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="710.3214285714286" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2012</tspan></text><text x="607.9642857142857" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2011</tspan></text><text x="505.60714285714283" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2010</tspan></text><text x="403.25" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2009</tspan></text><text x="300.8928571428571" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2008</tspan></text><text x="198.53571428571428" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2007</tspan></text><text x="96.17857142857143" y="275.5" text-anchor="middle" font-family="sans-serif" font-size="12px" stroke="none" fill="#888888" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: sans-serif; font-size: 12px; font-weight: normal;" font-weight="normal" transform="matrix(1,0,0,1,0,6)"><tspan dy="4.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">2006</tspan></text><rect x="57.79464285714286" y="25" width="36.88392857142857" height="238" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="97.67857142857143" y="48.80000000000001" width="36.88392857142857" height="214.2" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="160.15178571428572" y="84.5" width="36.88392857142857" height="178.5" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="200.03571428571428" y="108.30000000000001" width="36.88392857142857" height="154.7" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="262.50892857142856" y="144" width="36.88392857142857" height="119" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="302.3928571428571" y="167.8" width="36.88392857142857" height="95.19999999999999" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="364.86607142857144" y="84.5" width="36.88392857142857" height="178.5" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="404.75" y="108.30000000000001" width="36.88392857142857" height="154.7" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="467.22321428571433" y="144" width="36.88392857142857" height="119" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="507.1071428571429" y="167.8" width="36.88392857142857" height="95.19999999999999" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="569.5803571428572" y="84.5" width="36.88392857142857" height="178.5" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="609.4642857142858" y="108.30000000000001" width="36.88392857142857" height="154.7" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="671.9375" y="25" width="36.88392857142857" height="238" rx="0" ry="0" fill="#00a65a" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect><rect x="711.8214285714286" y="48.80000000000001" width="36.88392857142857" height="214.2" rx="0" ry="0" fill="#f56954" stroke="none" fill-opacity="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 1;"></rect></svg><div class="morris-hover morris-default-style" style="left: 166.536px; top: 112px; display: none;"><div class="morris-hover-row-label">2007</div>-->
                        <!--<div class="morris-hover-point" style="color: #00a65a">-->
                        <!--CPU:-->
                        <!--75-->
                        <!--</div>-->
                        <!--<div class="morris-hover-point" style="color: #f56954">-->
                        <!--DISK:-->
                        <!--65-->
                        <!--</div>-->
                    <!--</div></div>-->

                    <div id="Contentspjax" style="margin-top:50px">
                    <table id="example1" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th>访问IP</th>
                                <th>访问页面</th>
                                <th>访问次数</th>
                                <th>访问时间</th>
                                <th>地理位置</th>
                                <th>浏览器</th>
                                <th>操作系统</th>
                                <!--<th>语言</th>-->
                                <th>来源</th>
                            </tr>
                        </thead>
                        <tbody>
                            {foreach $list as $value}
                            <tr>
                                <td>{$value.ip}</td>
                                <td><a href="{$value.url}" target="_blank">{$value.url}</a></td>
                                <td>{$value.click}</td>
                                <td><?php echo friendlyDate(strtotime($value['addtime']));?></td>
                                <td>{$value.address}</td>
                                <td>{$value.browser}</td>
                                <td>{$value.os}</td>
                                <!--<td>{$value.lang}</td>-->
                                <td>{$value.from}</td>
                            </tr>
                            {/foreach}
                        </tbody>
                    </table>
                        <div class="row">
                            <div class="col-sm-5">
                                <div class="dataTables_info"  role="status" aria-live="polite"></div>
                            </div>
                            <div class="col-sm-7">
                                <div class="dataTables_paginate paging_simple_numbers" >
                                    {$list->render()|raw}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
    </div>
</section>
<!-- /.content -->
<script>
    $(function(){
        $('.select2').select2({
            language:'zh-CN'
        });
        $(".pjaxchangge").change(function(){
            var selectstr = '';
            $(".pjaxchangge").each(function(){
                var ids = $(this).attr('id');
                var gettype = $(this).attr('datavalue');
                selectstr = selectstr==''?gettype+"="+$('#'+ids).val():selectstr+"&"+gettype+"="+$('#'+ids).val();
            })

            selectstr = selectstr==''?'':'?'+selectstr;

            $.pjax({
                url: "{:Url::build('admin/Stat/statlist')}"+selectstr,
                container: '#Contentspjax'
            });
        });
        $(document).pjax('.pagination li a', '#Contentspjax', { timeout:3000,replace:true,scrollTo:false});
        $(document).on('pjax:start', function() { NProgress.start(); });
        $(document).on('pjax:end',   function() { NProgress.done();  });
    })
</script>
<script>
    $(function(){
        moment.locale('zh-cn');
        $('#daterange-btn').daterangepicker(
            {
                applyClass : 'btn-sm btn-success',
                cancelClass : 'btn-sm btn-default',
                locale: {
                    applyLabel: '确认',
                    cancelLabel: '取消',
                    fromLabel : '起始时间',
                    toLabel : '结束时间',
                    customRangeLabel : '自定义',
                    firstDay : 1
                },
                ranges   : {
                    '所有时间'       : [moment().subtract(9, 'days'), moment().subtract(9, 'days')],
                    '查询今天'       : [moment(), moment()],
                    '查询昨天'       : [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    '查询过去七天'   : [moment().subtract(6, 'days'), moment()],
                    '查询过去30天'   : [moment().subtract(29, 'days'), moment()],
                    '查询本月'       : [moment().startOf('month'), moment().endOf('month')],
                    '查询上个月'     : [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                startDate: moment().subtract(29, 'days'),
                endDate  : moment()
            },
            function (start, end, label) {
                if(label == '所有时间') {
                    $('#daterange-btn span').html('<i class="fa fa-calendar"></i> 所有时间');
                    $('#starttime').val('all');
                    $('#endtime').val('all');
                } else {
                    $('#daterange-btn span').html('<i class="fa fa-calendar"></i> '+start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'))
                    $('#starttime').val(start.format('YYYY-MM-DD'));
                    $('#endtime').val(end.format('YYYY-MM-DD'));
                }
                //pjax
                var pstr = '';
                $(".pjaxchangge").each(function(){
                    var ids = $(this).attr('id');
                    var gettype = $(this).attr('datavalue');
                    pstr = pstr==''?gettype+"="+$('#'+ids).val():pstr+"&"+gettype+"="+$('#'+ids).val();
                })
                pstr = pstr+"&starttime="+$('#starttime').val()+"&endtime="+$('#endtime').val();
                $.pjax({
                    url: "{:Url::build('admin/Stat/statlist')}?"+pstr,
                    container: '#Contentspjax'
                });
            }
        )
    })
</script>